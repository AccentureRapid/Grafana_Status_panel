{"version":3,"sources":["../src/status_ctrl.js"],"names":["MetricsPanelCtrl","_","TimeSeries","coreModule","StatusPluginCtrl","$scope","$injector","$log","$filter","annotationsSrv","filter","valueHandlers","aggregations","displayTypes","events","on","onRender","bind","postRefresh","onDataError","onDataReceived","onInitEditMode","addFilters","input","angular","isNumber","measurements","panel","targets","duplicates","measurement","hide","each","m","res","alias","target","length","addEditorTab","$panelContainer","find","css","$panelContoller","height","setElementHeight","upgradeOldVersion","clusterName","displayName","replace","RegExp","namePrefix","crit","warn","disabled","display","annotation","series","s","url","displayType","value","aggregation","max","datapoints","point","stats","min","total","avg","display_value","valueHandler","handleThresholdStatus","handleDisabledStatus","handleTextOnly","handleCssDisplay","parseUri","thresholds","parseThresholds","inverted","isCritical","isWarning","isCheckRanges","warnIsNumber","critIsNumber","push","disabledValue","removeClass","addClass","undefined","isGrayOnNoData","links","uri","dashUri","params","dataList","map","seriesHandler","render","scope","elem","attrs","ctrl","metricOptions","seriesData","flotpairs","getFlotPairs","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAQA,mB,kBAAAA,gB;;AAGDC,I;;AACAC,a;;AACAC,a;;;;;;;;;;;;;;;;;;;;;+BAIMC,gB;;;AACZ;AACA,8BAAYC,MAAZ,EAAoBC,SAApB,EAA+BC,IAA/B,EAAqCC,OAArC,EAA8CC,cAA9C,EAA8D;AAAA;;AAAA,qIACvDJ,MADuD,EAC/CC,SAD+C;;AAG7D;AACA,WAAKI,MAAL,GAAcF,OAAd;;AAEA,WAAKG,aAAL,GAAqB,CAAC,WAAD,EAAc,kBAAd,EAAkC,WAAlC,CAArB;AACA,WAAKC,YAAL,GAAoB,CAAC,MAAD,EAAS,OAAT,EAAkB,KAAlB,EAAyB,KAAzB,EAAgC,KAAhC,EAAuC,KAAvC,CAApB;AACA,WAAKC,YAAL,GAAoB,CAAC,SAAD,EAAY,YAAZ,CAApB;;AAEA;AACA,WAAKC,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,MAAKC,QAAL,CAAcC,IAAd,OAAzB;AACA,WAAKH,MAAL,CAAYC,EAAZ,CAAe,SAAf,EAA0B,MAAKG,WAAL,CAAiBD,IAAjB,OAA1B;AACA,WAAKH,MAAL,CAAYC,EAAZ,CAAe,YAAf,EAA6B,MAAKI,WAAL,CAAiBF,IAAjB,OAA7B;AACA,WAAKH,MAAL,CAAYC,EAAZ,CAAe,eAAf,EAAgC,MAAKK,cAAL,CAAoBH,IAApB,OAAhC;AACA,WAAKH,MAAL,CAAYC,EAAZ,CAAe,oBAAf,EAAqC,MAAKK,cAAL,CAAoBH,IAApB,OAArC;AACA,WAAKH,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKM,cAAL,CAAoBJ,IAApB,OAAjC;;AAEA,WAAKK,UAAL;AAlB6D;AAmB7D;;;;kCAGY;AAAA;;AACZnB,iBAAWO,MAAX,CAAkB,cAAlB,EAAkC,YAAM;AACvC,cAAO,UAACa,KAAD,EAAW;AACjB,YAAGC,QAAQC,QAAR,CAAiBF,KAAjB,CAAH,EAA4B;AAC3B,gBAAO,OAAKb,MAAL,CAAY,QAAZ,EAAsBa,KAAtB,CAAP;AACA,SAFD,MAEO;AACN,gBAAOA,KAAP;AACA;AACD,QAND;AAOA,OARD;AASA;;;mCAEa;AAAA;;AACb,WAAKG,YAAL,GAAoB,KAAKC,KAAL,CAAWC,OAA/B;;AAEA;AACA,WAAKC,UAAL,GAAkB,KAAlB;;AAEA,WAAKH,YAAL,GAAoBzB,EAAES,MAAF,CAAS,KAAKgB,YAAd,EAA4B,UAACI,WAAD,EAAiB;AAChE,cAAO,CAACA,YAAYC,IAApB;AACA,OAFmB,CAApB;;AAIA9B,QAAE+B,IAAF,CAAO,KAAKN,YAAZ,EAA0B,UAACO,CAAD,EAAO;AAChC,WAAIC,MAAMjC,EAAES,MAAF,CAAS,OAAKgB,YAAd,EAA4B,UAACI,WAAD,EAAiB;AACtD,eAAO,CAACG,EAAEE,KAAF,IAAWL,YAAYK,KAAvB,IAAiCF,EAAEG,MAAF,IAAYN,YAAYM,MAAxB,IAAkCH,EAAEG,MAAtE,KAAkF,CAACH,EAAEF,IAA5F;AACA,QAFS,CAAV;;AAIA,WAAIG,IAAIG,MAAJ,GAAa,CAAjB,EAAoB;AACnB,eAAKR,UAAL,GAAkB,IAAlB;AACA;AACD,OARD;AASA;;;sCAEgB;AAChB,WAAKS,YAAL,CAAkB,SAAlB,EAA6B,gDAA7B,EAA+E,CAA/E;AACA;;;wCAEkB;AAClB,WAAKC,eAAL,CAAqBC,IAArB,CAA0B,eAA1B,EAA2CC,GAA3C,CAA+C,QAA/C,EAAyD,KAAKC,eAAL,CAAqBC,MAArB,GAA8B,IAAvF;AACA;;;gCAEU;AAAA;;AACV,WAAKC,gBAAL;AACA,WAAKC,iBAAL;;AAEA,UAAI,KAAKlB,KAAL,CAAWmB,WAAf,EAA4B;AAC3B,YAAKnB,KAAL,CAAWoB,WAAX,GACC,KAAKrC,MAAL,CAAY,yBAAZ,EAAuC,KAAKiB,KAAL,CAAWmB,WAAlD,EAA+D,KAAKzC,MAApE,EACE2C,OADF,CACU,IAAIC,MAAJ,CAAW,KAAKtB,KAAL,CAAWuB,UAAtB,EAAkC,GAAlC,CADV,EACkD,EADlD,CADD;AAGA,OAJD,MAIO;AACN,YAAKvB,KAAL,CAAWoB,WAAX,GAAyB,EAAzB;AACA;;AAED,UAAInB,UAAU,KAAKD,KAAL,CAAWC,OAAzB;;AAEA,WAAKuB,IAAL,GAAY,EAAZ;AACA,WAAKC,IAAL,GAAY,EAAZ;AACA,WAAKC,QAAL,GAAgB,EAAhB;AACA,WAAKC,OAAL,GAAe,EAAf;AACA,WAAKC,UAAL,GAAkB,EAAlB;;AAEAtD,QAAE+B,IAAF,CAAO,KAAKwB,MAAZ,EAAoB,UAACC,CAAD,EAAO;AAC1B,WAAIrB,SAASnC,EAAEuC,IAAF,CAAOZ,OAAP,EAAgB,UAACQ,MAAD,EAAY;AACxC,eAAOA,OAAOD,KAAP,IAAgBsB,EAAEtB,KAAlB,IAA2BC,OAAOA,MAAP,IAAiBqB,EAAEtB,KAArD;AACA,QAFY,CAAb;;AAIA,WAAI,CAACC,MAAL,EAAa;AACZ;AACA;;AAEDqB,SAAEtB,KAAF,GAAUC,OAAOD,KAAjB;AACAsB,SAAEC,GAAF,GAAQtB,OAAOsB,GAAf;AACAD,SAAEH,OAAF,GAAY,IAAZ;AACAG,SAAEE,WAAF,GAAgBvB,OAAOuB,WAAvB;;AAEA,WAAIC,cAAJ;AACA,eAAQxB,OAAOyB,WAAf;AACC,aAAK,KAAL;AACCD,iBAAQ3D,EAAE6D,GAAF,CAAML,EAAEM,UAAR,EAAoB,UAACC,KAAD,EAAW;AAAE,iBAAOA,MAAM,CAAN,CAAP;AAAkB,UAAnD,EAAqD,CAArD,CAAR;AACAJ,iBAAQH,EAAEQ,KAAF,CAAQH,GAAhB;AACA;AACD,aAAK,KAAL;AACCF,iBAAQ3D,EAAEiE,GAAF,CAAMT,EAAEM,UAAR,EAAoB,UAACC,KAAD,EAAW;AAAE,iBAAOA,MAAM,CAAN,CAAP;AAAkB,UAAnD,EAAqD,CAArD,CAAR;AACAJ,iBAAQH,EAAEQ,KAAF,CAAQC,GAAhB;AACA;AACD,aAAK,KAAL;AACCN,iBAAQ,CAAR;AACA3D,WAAE+B,IAAF,CAAOyB,EAAEM,UAAT,EAAqB,UAACC,KAAD,EAAW;AAAEJ,mBAASI,MAAM,CAAN,CAAT;AAAmB,UAArD;AACAJ,iBAAQH,EAAEQ,KAAF,CAAQE,KAAhB;AACA;AACD,aAAK,KAAL;AACCP,iBAAQH,EAAEQ,KAAF,CAAQG,GAAhB;AACA;AACD,aAAK,OAAL;AACCR,iBAAQH,EAAEM,UAAF,CAAa,CAAb,EAAgB,CAAhB,CAAR;AACA;AACD;AACCH,iBAAQH,EAAEM,UAAF,CAAaN,EAAEM,UAAF,CAAa1B,MAAb,GAAsB,CAAnC,EAAsC,CAAtC,CAAR;AArBF;;AAwBAoB,SAAEY,aAAF,GAAkBT,KAAlB;;AAEA,WAAIxB,OAAOkC,YAAP,IAAuB,WAA3B,EAAwC;AACvC,eAAKC,qBAAL,CAA2Bd,CAA3B,EAA8BrB,MAA9B;AACA,QAFD,MAGK,IAAIA,OAAOkC,YAAP,IAAuB,kBAA3B,EAA+C;AACnD,eAAKE,oBAAL,CAA0Bf,CAA1B,EAA4BrB,MAA5B;AACA,QAFI,MAGA,IAAIA,OAAOkC,YAAP,IAAuB,WAA3B,EAAwC;AAC5C,eAAKG,cAAL,CAAoBhB,CAApB,EAAuBrB,MAAvB;AACA;AACD,OAlDD;;AAoDA,UAAG,KAAKiB,QAAL,CAAchB,MAAd,GAAuB,CAA1B,EAA6B;AAC5B,YAAKc,IAAL,GAAY,EAAZ;AACA,YAAKC,IAAL,GAAY,EAAZ;AACA,YAAKE,OAAL,GAAe,EAAf;AACA;;AAED,WAAKoB,gBAAL;AACA,WAAKC,QAAL;AACA;;;yCAEmB;AAAA;;AACnB,UAAI/C,UAAU,KAAKD,KAAL,CAAWC,OAAzB;;AAEA;AACA3B,QAAE+B,IAAF,CAAOJ,OAAP,EAAgB,UAACQ,MAAD,EAAY;AAC3B,WAAGA,OAAOkC,YAAP,IAAuB,IAA1B,EAAgC;AAC/BlC,eAAOkC,YAAP,GAAsBlC,OAAOuB,WAA7B;AACA,YAAGvB,OAAOkC,YAAP,IAAuB,YAA1B,EAAwC;AACvClC,gBAAOkC,YAAP,GAAsB,WAAtB;AACA;AACDlC,eAAOuB,WAAP,GAAqB,OAAK9C,YAAL,CAAkB,CAAlB,CAArB;AACA;AACD,OARD;AASA;;;2CAEqB2C,M,EAAQpB,M,EAAQ;AACrCoB,aAAOoB,UAAP,GAAoBxE,iBAAiByE,eAAjB,CAAiCzC,MAAjC,CAApB;AACAoB,aAAOsB,QAAP,GAAkBtB,OAAOoB,UAAP,CAAkBzB,IAAlB,GAAyBK,OAAOoB,UAAP,CAAkBxB,IAA7D;AACAI,aAAOF,OAAP,GAAiBlB,OAAOkB,OAAxB;;AAEA,UAAIyB,aAAa,KAAjB;AACA,UAAIC,YAAY,KAAhB;AACA,UAAIC,gBAAgBzB,OAAOoB,UAAP,CAAkBM,YAAlB,IAAkC1B,OAAOoB,UAAP,CAAkBO,YAAxE;AACA,UAAIF,aAAJ,EAAmB;AAClB,WAAI,CAACzB,OAAOsB,QAAZ,EAAsB;AACrB,YAAItB,OAAOa,aAAP,IAAwBb,OAAOoB,UAAP,CAAkBzB,IAA9C,EAAoD;AACnD4B,sBAAa,IAAb;AACA,SAFD,MAEO,IAAIvB,OAAOa,aAAP,IAAwBb,OAAOoB,UAAP,CAAkBxB,IAA9C,EAAoD;AAC1D4B,qBAAY,IAAZ;AACA;AACD,QAND,MAMO;AACN,YAAIxB,OAAOa,aAAP,IAAwBb,OAAOoB,UAAP,CAAkBzB,IAA9C,EAAoD;AACnD4B,sBAAa,IAAb;AACA,SAFD,MAEO,IAAIvB,OAAOa,aAAP,IAAwBb,OAAOoB,UAAP,CAAkBxB,IAA9C,EAAoD;AAC1D4B,qBAAY,IAAZ;AACA;AACD;AACD,OAdD,MAcO;AACN,WAAIxB,OAAOa,aAAP,IAAwBb,OAAOoB,UAAP,CAAkBzB,IAA9C,EAAoD;AACnD4B,qBAAa,IAAb;AACA,QAFD,MAEO,IAAIvB,OAAOa,aAAP,IAAwBb,OAAOoB,UAAP,CAAkBxB,IAA9C,EAAoD;AAC1D4B,oBAAY,IAAZ;AACA;AACD;;AAED,UAAGD,UAAH,EAAe;AACd,YAAK5B,IAAL,CAAUiC,IAAV,CAAe5B,MAAf;AACAA,cAAOG,WAAP,GAAqB,KAAK9C,YAAL,CAAkB,CAAlB,CAArB;AACA,OAHD,MAGO,IAAGmE,SAAH,EAAc;AACpB,YAAK5B,IAAL,CAAUgC,IAAV,CAAe5B,MAAf;AACAA,cAAOG,WAAP,GAAqB,KAAK9C,YAAL,CAAkB,CAAlB,CAArB;AACA,OAHM,MAGA,IAAI2C,OAAOF,OAAX,EAAoB;AAC1B,WAAGE,OAAOG,WAAP,IAAsB,YAAzB,EAAuC;AACtC,aAAKJ,UAAL,CAAgB6B,IAAhB,CAAqB5B,MAArB;AACA,QAFD,MAEO;AACN,aAAKF,OAAL,CAAa8B,IAAb,CAAkB5B,MAAlB;AACA;AACD;AACD;;;0CAEoBA,M,EAAQpB,M,EAAQ;AACpCoB,aAAOG,WAAP,GAAqB,KAAK9C,YAAL,CAAkB,CAAlB,CAArB;AACA2C,aAAO6B,aAAP,GAAuBjD,OAAOiD,aAA9B;;AAEA,UAAI7B,OAAOa,aAAP,IAAwBb,OAAO6B,aAAnC,EAAkD;AACjD,YAAKhC,QAAL,CAAc+B,IAAd,CAAmB5B,MAAnB;AACA;AACD;;;oCAEcA,M,EAAQpB,M,EAAQ;AAC9B,UAAGoB,OAAOG,WAAP,IAAsB,YAAzB,EAAuC;AACtC,YAAKJ,UAAL,CAAgB6B,IAAhB,CAAqB5B,MAArB;AACA,OAFD,MAEO;AACN,YAAKF,OAAL,CAAa8B,IAAb,CAAkB5B,MAAlB;AACA;AACD;;;wCAEkB;AAClB,WAAKjB,eAAL,CAAqB+C,WAArB,CAAiC,8DAAjC;;AAEA,UAAG,KAAKzD,UAAR,EAAoB;AACnB,YAAKU,eAAL,CAAqBgD,QAArB,CAA8B,aAA9B;AACA,OAFD,MAEO,IAAI,KAAKlC,QAAL,CAAchB,MAAd,GAAuB,CAA3B,EAA8B;AACpC,YAAKE,eAAL,CAAqBgD,QAArB,CAA8B,gBAA9B;AACA,OAFM,MAEA,IAAI,KAAKpC,IAAL,CAAUd,MAAV,GAAmB,CAAvB,EAA0B;AAChC,YAAKE,eAAL,CAAqBgD,QAArB,CAA8B,aAA9B;AACA,OAFM,MAEA,IAAI,KAAKnC,IAAL,CAAUf,MAAV,GAAmB,CAAvB,EAA0B;AAChC,YAAKE,eAAL,CAAqBgD,QAArB,CAA8B,YAA9B;AACA,OAFM,MAEA,IAAG,CAAC,KAAK/B,MAAL,IAAegC,SAAf,IAA4B,KAAKhC,MAAL,CAAYnB,MAAZ,IAAsB,CAAnD,KAAyD,KAAKV,KAAL,CAAW8D,cAAvE,EAAuF;AAC7F,YAAKlD,eAAL,CAAqBgD,QAArB,CAA8B,eAA9B;AACA,OAFM,MAEA;AACN,YAAKhD,eAAL,CAAqBgD,QAArB,CAA8B,UAA9B;AACA;AACD;;;gCAEU;AACV,UAAI,KAAK5D,KAAL,CAAW+D,KAAX,IAAoB,KAAK/D,KAAL,CAAW+D,KAAX,CAAiBrD,MAAjB,GAA0B,CAAlD,EAAqD;AACpD,YAAKsD,GAAL,GAAW,KAAKhE,KAAL,CAAW+D,KAAX,CAAiB,CAAjB,EAAoBE,OAApB,GAA8B,GAA9B,GAAoC,KAAKjE,KAAL,CAAW+D,KAAX,CAAiB,CAAjB,EAAoBG,MAAnE;AACA,OAFD,MAEO;AACN,YAAKF,GAAL,GAAWH,SAAX;AACA;AACD;;;oCAacM,Q,EAAU;AACxB,WAAKtC,MAAL,GAAcsC,SAASC,GAAT,CAAa3F,iBAAiB4F,aAAjB,CAA+B/E,IAA/B,CAAoC,IAApC,CAAb,CAAd;;AAEA,WAAKgF,MAAL;AACA;;;mCAEa;AACb,WAAK9C,IAAL,GAAY,EAAZ;AACA,WAAKC,IAAL,GAAY,EAAZ;AACA;;;0BAaI8C,K,EAAOC,I,EAAMC,K,EAAOC,I,EAAM;AAC9B,WAAK9D,eAAL,GAAuB4D,KAAK3D,IAAL,CAAU,kBAAV,CAAvB;AACA,WAAKE,eAAL,GAAuB2D,IAAvB;AACA;;;qCApCsBC,a,EAAe;AACrC,UAAIpE,MAAM,EAAV;;AAEAA,UAAIkB,IAAJ,GAAWkD,cAAclD,IAAzB;AACAlB,UAAIgD,YAAJ,GAAmB1D,QAAQC,QAAR,CAAiBS,IAAIkB,IAArB,CAAnB;AACAlB,UAAIiB,IAAJ,GAAWmD,cAAcnD,IAAzB;AACAjB,UAAIiD,YAAJ,GAAmB3D,QAAQC,QAAR,CAAiBS,IAAIiB,IAArB,CAAnB;;AAEA,aAAOjB,GAAP;AACA;;;mCAaoBqE,U,EAAY;AAChC,UAAI/C,SAAS,IAAItD,UAAJ,CAAe;AAC3B6D,mBAAYwC,WAAWxC,UADI;AAE3B5B,cAAOoE,WAAWnE;AAFS,OAAf,CAAb;;AAKAoB,aAAOgD,SAAP,GAAmBhD,OAAOiD,YAAP,CAAoB,WAApB,CAAnB;;AAEA,aAAOjD,MAAP;AACA;;;;KAzRoCxD,gB;;;;AAiStCI,oBAAiBsG,WAAjB,GAA+B,aAA/B","file":"status_ctrl.js","sourcesContent":["import {MetricsPanelCtrl} from \"app/plugins/sdk\";\nimport \"app/plugins/panel/graph/legend\";\nimport \"app/plugins/panel/graph/series_overrides_ctrl\";\nimport _ from \"lodash\";\nimport TimeSeries from \"app/core/time_series2\";\nimport coreModule from \"app/core/core_module\"\n\nimport './css/status_panel.css!';\n\nexport class StatusPluginCtrl extends MetricsPanelCtrl {\n\t/** @ngInject */\n\tconstructor($scope, $injector, $log, $filter, annotationsSrv) {\n\t\tsuper($scope, $injector);\n\n\t\t//this.log = $log.debug;\n\t\tthis.filter = $filter;\n\n\t\tthis.valueHandlers = ['Threshold', 'Disable Criteria', 'Text Only'];\n\t\tthis.aggregations = ['Last', 'First', 'Max', 'Min', 'Sum', 'Avg'];\n\t\tthis.displayTypes = ['Regular', 'Annotation'];\n\n\t\t/** Bind events to functions **/\n\t\tthis.events.on('render', this.onRender.bind(this));\n\t\tthis.events.on('refresh', this.postRefresh.bind(this));\n\t\tthis.events.on('data-error', this.onDataError.bind(this));\n\t\tthis.events.on('data-received', this.onDataReceived.bind(this));\n\t\tthis.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n\t\tthis.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n\n\t\tthis.addFilters()\n\t}\n\n\n\taddFilters() {\n\t\tcoreModule.filter('numberOrText', () => {\n\t\t\treturn (input) => {\n\t\t\t\tif(angular.isNumber(input)) {\n\t\t\t\t\treturn this.filter('number')(input);\n\t\t\t\t} else {\n\t\t\t\t\treturn input;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tpostRefresh() {\n\t\tthis.measurements = this.panel.targets;\n\n\t\t/** Duplicate alias validation **/\n\t\tthis.duplicates = false;\n\n\t\tthis.measurements = _.filter(this.measurements, (measurement) => {\n\t\t\treturn !measurement.hide;\n\t\t});\n\n\t\t_.each(this.measurements, (m) => {\n\t\t\tlet res = _.filter(this.measurements, (measurement) => {\n\t\t\t\treturn (m.alias == measurement.alias || (m.target == measurement.target && m.target)) && !m.hide;\n\t\t\t});\n\n\t\t\tif (res.length > 1) {\n\t\t\t\tthis.duplicates = true;\n\t\t\t}\n\t\t});\n\t}\n\n\tonInitEditMode() {\n\t\tthis.addEditorTab('Options', 'public/plugins/vonage-status-panel/editor.html', 2);\n\t}\n\n\tsetElementHeight() {\n\t\tthis.$panelContainer.find('.status-panel').css('height', this.$panelContoller.height + 'px');\n\t}\n\n\tonRender() {\n\t\tthis.setElementHeight();\n\t\tthis.upgradeOldVersion();\n\n\t\tif (this.panel.clusterName) {\n\t\t\tthis.panel.displayName =\n\t\t\t\tthis.filter('interpolateTemplateVars')(this.panel.clusterName, this.$scope)\n\t\t\t\t\t.replace(new RegExp(this.panel.namePrefix, 'i'), '');\n\t\t} else {\n\t\t\tthis.panel.displayName = \"\";\n\t\t}\n\n\t\tlet targets = this.panel.targets;\n\n\t\tthis.crit = [];\n\t\tthis.warn = [];\n\t\tthis.disabled = [];\n\t\tthis.display = [];\n\t\tthis.annotation = [];\n\n\t\t_.each(this.series, (s) => {\n\t\t\tlet target = _.find(targets, (target) => {\n\t\t\t\treturn target.alias == s.alias || target.target == s.alias;\n\t\t\t});\n\n\t\t\tif (!target) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ts.alias = target.alias;\n\t\t\ts.url = target.url;\n\t\t\ts.display = true;\n\t\t\ts.displayType = target.displayType;\n\n\t\t\tlet value;\n\t\t\tswitch (target.aggregation) {\n\t\t\t\tcase 'Max':\n\t\t\t\t\tvalue = _.max(s.datapoints, (point) => { return point[0]; })[0];\n\t\t\t\t\tvalue = s.stats.max;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'Min':\n\t\t\t\t\tvalue = _.min(s.datapoints, (point) => { return point[0]; })[0];\n\t\t\t\t\tvalue = s.stats.min;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'Sum':\n\t\t\t\t\tvalue = 0;\n\t\t\t\t\t_.each(s.datapoints, (point) => { value += point[0] });\n\t\t\t\t\tvalue = s.stats.total;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'Avg':\n\t\t\t\t\tvalue = s.stats.avg;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'First':\n\t\t\t\t\tvalue = s.datapoints[0][0];\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tvalue = s.datapoints[s.datapoints.length - 1][0];\n\t\t\t}\n\n\t\t\ts.display_value = value;\n\n\t\t\tif (target.valueHandler == \"Threshold\") {\n\t\t\t\tthis.handleThresholdStatus(s, target);\n\t\t\t}\n\t\t\telse if (target.valueHandler == \"Disable Criteria\") {\n\t\t\t\tthis.handleDisabledStatus(s,target);\n\t\t\t}\n\t\t\telse if (target.valueHandler == \"Text Only\") {\n\t\t\t\tthis.handleTextOnly(s, target);\n\t\t\t}\n\t\t});\n\n\t\tif(this.disabled.length > 0) {\n\t\t\tthis.crit = [];\n\t\t\tthis.warn = [];\n\t\t\tthis.display = [];\n\t\t}\n\n\t\tthis.handleCssDisplay();\n\t\tthis.parseUri();\n\t}\n\n\tupgradeOldVersion() {\n\t\tlet targets = this.panel.targets;\n\n\t\t//Handle legacy code\n\t\t_.each(targets, (target) => {\n\t\t\tif(target.valueHandler == null) {\n\t\t\t\ttarget.valueHandler = target.displayType;\n\t\t\t\tif(target.valueHandler == \"Annotation\") {\n\t\t\t\t\ttarget.valueHandler = \"Text Only\"\n\t\t\t\t}\n\t\t\t\ttarget.displayType = this.displayTypes[0];\n\t\t\t}\n\t\t});\n\t}\n\n\thandleThresholdStatus(series, target) {\n\t\tseries.thresholds = StatusPluginCtrl.parseThresholds(target);\n\t\tseries.inverted = series.thresholds.crit < series.thresholds.warn;\n\t\tseries.display = target.display;\n\n\t\tvar isCritical = false;\n\t\tvar isWarning = false;\n\t\tlet isCheckRanges = series.thresholds.warnIsNumber && series.thresholds.critIsNumber;\n\t\tif (isCheckRanges) {\n\t\t\tif (!series.inverted) {\n\t\t\t\tif (series.display_value >= series.thresholds.crit) {\n\t\t\t\t\tisCritical = true\n\t\t\t\t} else if (series.display_value >= series.thresholds.warn) {\n\t\t\t\t\tisWarning = true\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (series.display_value <= series.thresholds.crit) {\n\t\t\t\t\tisCritical = true\n\t\t\t\t} else if (series.display_value <= series.thresholds.warn) {\n\t\t\t\t\tisWarning = true\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (series.display_value == series.thresholds.crit) {\n\t\t\t\tisCritical = true\n\t\t\t} else if (series.display_value == series.thresholds.warn) {\n\t\t\t\tisWarning = true\n\t\t\t}\n\t\t}\n\n\t\tif(isCritical) {\n\t\t\tthis.crit.push(series);\n\t\t\tseries.displayType = this.displayTypes[0]\n\t\t} else if(isWarning) {\n\t\t\tthis.warn.push(series);\n\t\t\tseries.displayType = this.displayTypes[0]\n\t\t} else if (series.display) {\n\t\t\tif(series.displayType == \"Annotation\") {\n\t\t\t\tthis.annotation.push(series);\n\t\t\t} else {\n\t\t\t\tthis.display.push(series);\n\t\t\t}\n\t\t}\n\t}\n\n\thandleDisabledStatus(series, target) {\n\t\tseries.displayType = this.displayTypes[0];\n\t\tseries.disabledValue = target.disabledValue;\n\n\t\tif (series.display_value == series.disabledValue) {\n\t\t\tthis.disabled.push(series);\n\t\t}\n\t}\n\n\thandleTextOnly(series, target) {\n\t\tif(series.displayType == \"Annotation\") {\n\t\t\tthis.annotation.push(series);\n\t\t} else {\n\t\t\tthis.display.push(series);\n\t\t}\n\t}\n\n\thandleCssDisplay() {\n\t\tthis.$panelContainer.removeClass('error-state warn-state disabled-state ok-state no-data-state');\n\n\t\tif(this.duplicates) {\n\t\t\tthis.$panelContainer.addClass('error-state');\n\t\t} else if (this.disabled.length > 0) {\n\t\t\tthis.$panelContainer.addClass('disabled-state');\n\t\t} else if (this.crit.length > 0) {\n\t\t\tthis.$panelContainer.addClass('error-state');\n\t\t} else if (this.warn.length > 0) {\n\t\t\tthis.$panelContainer.addClass('warn-state');\n\t\t} else if((this.series == undefined || this.series.length == 0) && this.panel.isGrayOnNoData) {\n\t\t\tthis.$panelContainer.addClass('no-data-state');\n\t\t} else {\n\t\t\tthis.$panelContainer.addClass('ok-state');\n\t\t}\n\t}\n\n\tparseUri() {\n\t\tif (this.panel.links && this.panel.links.length > 0) {\n\t\t\tthis.uri = this.panel.links[0].dashUri + \"?\" + this.panel.links[0].params;\n\t\t} else {\n\t\t\tthis.uri = undefined;\n\t\t}\n\t}\n\n\tstatic parseThresholds(metricOptions) {\n\t\tlet res = {};\n\n\t\tres.warn = metricOptions.warn;\n\t\tres.warnIsNumber = angular.isNumber(res.warn);\n\t\tres.crit = metricOptions.crit;\n\t\tres.critIsNumber = angular.isNumber(res.crit);\n\n\t\treturn res;\n\t}\n\n\tonDataReceived(dataList) {\n\t\tthis.series = dataList.map(StatusPluginCtrl.seriesHandler.bind(this));\n\n\t\tthis.render();\n\t}\n\n\tonDataError() {\n\t\tthis.crit = [];\n\t\tthis.warn = [];\n\t}\n\n\tstatic seriesHandler(seriesData) {\n\t\tvar series = new TimeSeries({\n\t\t\tdatapoints: seriesData.datapoints,\n\t\t\talias: seriesData.target\n\t\t});\n\n\t\tseries.flotpairs = series.getFlotPairs(\"connected\");\n\n\t\treturn series;\n\t}\n\n\tlink(scope, elem, attrs, ctrl) {\n\t\tthis.$panelContainer = elem.find('.panel-container');\n\t\tthis.$panelContoller = ctrl;\n\t}\n}\n\nStatusPluginCtrl.templateUrl = 'module.html';\n"]}